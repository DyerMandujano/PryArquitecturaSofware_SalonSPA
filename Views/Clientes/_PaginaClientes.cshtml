@{
    int pageNumber = ViewBag.PageNumber ?? 1;
    int pageSize = ViewBag.PageSize ?? 10;
    int totalPaginas = ViewBag.TotalPaginas ?? 0;
    int totalRegistros = ViewBag.TotalRegistros ?? 0;

    string busqueda = ViewBag.Busqueda;
    int? estado = ViewBag.Estado;
    string fechaInicio = ViewBag.FechaInicio;
    string fechaFin = ViewBag.FechaFin;
}

<link href="~/css/VClientes/_PaginaClientes.css" rel="stylesheet" />

<div class="paginacion-container">

    <!-- 1. Selector de tamaño de página (PRIMERO) -->
    <div class="paginacion-size">
        <form method="get" asp-action="Index" style="display: flex; align-items: center; gap: 0.5rem;">
            <input type="hidden" name="busqueda" value="@busqueda" />
            <input type="hidden" name="estado" value="@estado" />
            <input type="hidden" name="fechaInicio" value="@fechaInicio" />
            <input type="hidden" name="fechaFin" value="@fechaFin" />
            <input type="hidden" name="pageNumber" value="1" />

            <label for="pageSize">Registros por página:</label>
            <select name="pageSize" id="pageSize" class="select-pagesize" onchange="this.form.submit()">
                <option value="10" selected="@(pageSize == 10)">10</option>
                <option value="20" selected="@(pageSize == 20)">20</option>
                <option value="50" selected="@(pageSize == 50)">50</option>
            </select>
        </form>
    </div>

    <!-- 2. Controles de paginación (SEGUNDO) -->
    @if (totalPaginas > 1)
    {
        <div class="paginacion-controles">
            @if (pageNumber > 1)
            {
                <a asp-action="Index"
                   asp-route-busqueda="@busqueda"
                   asp-route-estado="@estado"
                   asp-route-fechaInicio="@fechaInicio"
                   asp-route-fechaFin="@fechaFin"
                   asp-route-pageNumber="1"
                   asp-route-pageSize="@pageSize"
                   class="btn-paginacion"
                   title="Primera página">
                    «
                </a>

                <a asp-action="Index"
                   asp-route-busqueda="@busqueda"
                   asp-route-estado="@estado"
                   asp-route-fechaInicio="@fechaInicio"
                   asp-route-fechaFin="@fechaFin"
                   asp-route-pageNumber="@(pageNumber - 1)"
                   asp-route-pageSize="@pageSize"
                   class="btn-paginacion"
                   title="Anterior">
                    ‹
                </a>
            }

            @{
                int inicio = Math.Max(1, pageNumber - 2);
                int fin = Math.Min(totalPaginas, pageNumber + 2);
            }

            @for (int i = inicio; i <= fin; i++)
            {
                if (i == pageNumber)
                {
                    <span class="btn-paginacion activo">@i</span>
                }
                else
                {
                    <a asp-action="Index"
                       asp-route-busqueda="@busqueda"
                       asp-route-estado="@estado"
                       asp-route-fechaInicio="@fechaInicio"
                       asp-route-fechaFin="@fechaFin"
                       asp-route-pageNumber="@i"
                       asp-route-pageSize="@pageSize"
                       class="btn-paginacion">
                        @i
                    </a>
                }
            }

            @if (pageNumber < totalPaginas)
            {
                <a asp-action="Index"
                   asp-route-busqueda="@busqueda"
                   asp-route-estado="@estado"
                   asp-route-fechaInicio="@fechaInicio"
                   asp-route-fechaFin="@fechaFin"
                   asp-route-pageNumber="@(pageNumber + 1)"
                   asp-route-pageSize="@pageSize"
                   class="btn-paginacion"
                   title="Siguiente">
                    ›
                </a>

                <a asp-action="Index"
                   asp-route-busqueda="@busqueda"
                   asp-route-estado="@estado"
                   asp-route-fechaInicio="@fechaInicio"
                   asp-route-fechaFin="@fechaFin"
                   asp-route-pageNumber="@totalPaginas"
                   asp-route-pageSize="@pageSize"
                   class="btn-paginacion"
                   title="Última página">
                    »
                </a>
            }
        </div>
    }
    else
    {
        <div class="paginacion-controles" style="visibility: hidden;">
            <span class="btn-paginacion">1</span>
        </div>
    }

    <div class="paginacion-info">
        <p>Página @pageNumber de @totalPaginas (@totalRegistros registros)</p>
    </div>

</div>
