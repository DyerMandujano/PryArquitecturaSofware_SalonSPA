@model Pry_Solu_SalonSPA.Models.Cita

@{
    Layout = "~/Views/Main.cshtml";
    ViewData["Title"] = "Registrar Cita";
}

<link href="~/css/VCitas/_CrearCitas.css" rel="stylesheet" />

<div class="crear-cita-wrapper">
    <div class="crear-cita-box">
        
        <a asp-action="Index"
           asp-route-dni="@ViewBag.ReturnDni"
           asp-route-fechaInicio="@ViewBag.ReturnFechaInicio"
           asp-route-fechaFin="@ViewBag.ReturnFechaFin"
           asp-route-estadoCita="@ViewBag.ReturnEstadoCita"
           asp-route-estadoServicio="@ViewBag.ReturnEstadoServicio"
           asp-route-pageNumber="@ViewBag.ReturnPageNumber"
           asp-route-pageSize="@ViewBag.ReturnPageSize"
           class="btn-back">← Volver</a>

        <div class="header-crear">
            <h2>Registrar Cita</h2>
        </div>

        @if (TempData["Mensaje"] != null)
        {
            <div class="alert-success">@TempData["Mensaje"]</div>
        }

        <div class="seccion-cliente">
            <h3 class="seccion-titulo">Datos del Cliente</h3>

            <form asp-action="BuscarClientePorDniPost" method="post">
                @Html.AntiForgeryToken()
                <div class="form-row">
                    <div class="form-group">
                        <label for="dni">DNI del Cliente</label>
                        <input id="dni"
                               type="text"
                               name="dni"
                               placeholder="Ingrese DNI para buscar"
                               class="editable-field"
                               maxlength="15"
                               value="@ViewBag.DniBuscado" />
                    </div>

                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button type="submit" class="btn-buscar">Buscar Cliente</button>
                    </div>
                </div>
            </form>

            @if (ViewBag.ClienteEncontrado != null)
            {
                <div class="form-row">
                    <div class="form-group">
                        <label>Nombres</label>
                        <input type="text"
                               readonly
                               value="@ViewBag.ClienteEncontrado.Nombres"
                               class="readonly-field" />
                    </div>

                    <div class="form-group">
                        <label>Apellidos</label>
                        <input type="text"
                               readonly
                               value="@ViewBag.ClienteEncontrado.Apellidos"
                               class="readonly-field" />
                    </div>
                </div>
            }
            else
            {
                <div class="form-row">
                    <div class="form-group">
                        <label>Nombres</label>
                        <input type="text"
                               readonly
                               placeholder="Busque un cliente por DNI"
                               class="readonly-field" />
                    </div>

                    <div class="form-group">
                        <label>Apellidos</label>
                        <input type="text"
                               readonly
                               placeholder="Busque un cliente por DNI"
                               class="readonly-field" />
                    </div>
                </div>
            }

            <div class="form-row">
                <div class="form-group">
                    <label>Estado del Servicio</label>
                    <input type="text"
                           readonly
                           value="Activo"
                           class="readonly-field estado-activo" />
                </div>
            </div>
        </div>

        <form asp-action="Crear" method="post" class="form-cita">
            @Html.AntiForgeryToken()

            @if (ViewBag.ClienteEncontrado != null)
            {
                <input type="hidden" name="IdCliente" value="@ViewBag.ClienteEncontrado.IdCliente" />
            }

            <input type="hidden" name="Estado_Cita_Servicio" value="1" />

            <div class="seccion-cita">
                <h3 class="seccion-titulo">Datos de la Cita</h3>

                <div class="form-row">
                    <div class="form-group">
                        <label for="IdEmpleadoHorario">Empleado</label>
                        <select id="IdEmpleadoHorario"
                                name="IdEmpleadoHorario"
                                asp-items="ViewBag.Empleados"
                                class="editable-field"
                                required>
                            <option value="">Seleccione un empleado</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="IdServicio">Servicio</label>
                        <select id="IdServicio"
                                name="IdServicio"
                                asp-items="ViewBag.Servicios"
                                class="editable-field"
                                required>
                            <option value="">Seleccione un servicio</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="FechaCita">Fecha y Hora de Cita</label>
                        <input id="FechaCita"
                               type="datetime-local"
                               name="FechaCita"
                               class="editable-field"
                               required />
                    </div>

                    <div class="form-group">
                        <label for="Estado_Cita">Estado de la Cita</label>
                        <select id="Estado_Cita"
                                name="Estado_Cita"
                                class="editable-field"
                                required>
                            <option value="1" selected>Pendiente</option>
                            <option value="2">Completado</option>
                            <option value="3">Reprogramado</option>
                            <option value="4">Cancelado</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="ObsServicio">Observación del Servicio</label>
                    <input id="ObsServicio"
                           type="text"
                           name="ObsServicio"
                           class="editable-field"
                           placeholder="Escriba una observación (opcional)"
                           maxlength="100" />
                </div>

                <div class="form-buttons">
                    <a asp-action="Index" class="btn-cancelar">Cancelar</a>
                    <button type="submit" class="btn-crear">Guardar Cita</button>
                </div>
            </div>
        </form>
    </div>
</div>
